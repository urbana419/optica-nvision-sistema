<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - √ìptica nVision</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            color: white; 
            padding: 20px;
        }
        .container { max-width: 500px; margin: 0 auto; }
        
        .header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-btn {
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 12px;
            cursor: pointer;
            border: 1px solid;
            font-weight: 600;
            transition: all 0.3s ease;
            touch-action: manipulation;
            margin: 5px;
        }
        
        .btn-home {
            background: rgba(34, 211, 238, 0.2);
            color: #22d3ee;
            border-color: rgba(34, 211, 238, 0.3);
        }
        
        .btn-pos {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .form-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            color: #fbbf24;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e2e8f0;
            font-size: 14px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 15px;
            font-size: 16px;
            font-family: inherit;
        }
        
        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .camera-upload {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 50px 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }
        
        .camera-upload:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #22d3ee;
        }
        
        .camera-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }
        
        .preview-image {
            max-width: 100%;
            width: 100%;
            height: auto;
            max-height: 300px;
            border-radius: 15px;
            margin-top: 20px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            object-fit: cover;
        }
        
        .btn {
            padding: 18px 20px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            touch-action: manipulation;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #22d3ee, #0891b2);
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn-share {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .btn-whatsapp {
            background: #25d366;
            color: white;
        }

        .btn-copy {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .share-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .alert {
            background: rgba(34, 211, 238, 0.2);
            border: 1px solid rgba(34, 211, 238, 0.3);
            color: #22d3ee;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }
        
        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .footer-credits {
            position: fixed;
            bottom: 10px;
            right: 25px;
            font-size: 10px;
            font-weight: 600;
            opacity: 0.8;
            z-index: 999;
            background: linear-gradient(45deg, #8B4513, #DAA520);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Panel de Administraci√≥n</h1>
            <p>Gesti√≥n completa de √ìptica nVision</p>
            <div style="margin-top: 15px;">
                <button onclick="irASitio()" class="header-btn btn-home">
                    üè† Sitio Principal
                </button>
                <button onclick="irAPOS()" class="header-btn btn-pos">
                    üíº Sistema POS
                </button>
            </div>
        </div>

        <div id="alertContainer"></div>

        <div class="form-section">
            <h2 class="section-title">‚ûï Agregar Nuevo Producto</h2>
            
            <div class="form-group">
                <label class="form-label">üì∏ Foto del Producto</label>
                <div class="camera-upload" onclick="abrirCamara()">
                    <span class="camera-icon">üì∑</span>
                    <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Tomar/Subir Foto</div>
                    <div style="font-size: 14px; opacity: 0.8;">Toque para activar c√°mara</div>
                    <img id="vistaPrevia" class="preview-image" style="display: none;">
                </div>
                <input type="file" id="inputFoto" accept="image/*" capture="environment" style="display: none;">
                
                <div id="botonesCompartir" class="share-buttons" style="display: none;">
                    <button type="button" onclick="copiarEnlace()" class="btn-share btn-copy">
                        üìã Copiar Enlace
                    </button>
                    <button type="button" onclick="compartirWhatsApp()" class="btn-share btn-whatsapp">
                        üì± Compartir WhatsApp
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">üî¢ C√≥digo del Producto</label>
                <input type="text" id="codigoProducto" class="form-input" placeholder="NV001" style="text-transform: uppercase;">
            </div>
            
            <div class="form-group">
                <label class="form-label">üëì Nombre/Descripci√≥n</label>
                <input type="text" id="nombreProducto" class="form-input" placeholder="Monturas deportivas polarizadas">
            </div>
            
            <div class="form-group">
                <label class="form-label">üí∞ Precio (RD$)</label>
                <input type="number" id="precioProducto" class="form-input" placeholder="2500.00" step="0.01">
            </div>
            
            <div class="form-group">
                <label class="form-label">üìÇ Categor√≠a</label>
                <select id="categoriaProducto" class="form-select">
                    <option value="hombre">üë® Hombres</option>
                    <option value="mujer">üë© Mujeres</option>
                    <option value="deportivo">üèÉ Deportivos</option>
                    <option value="ni√±os">üë∂ Ni√±os</option>
                    <option value="lectura">üìñ Lectura</option>
                    <option value="sol">üï∂Ô∏è Sol</option>
                    <option value="trabajo">üíº Trabajo</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">üìù Comentarios adicionales</label>
                <textarea id="comentariosProducto" class="form-textarea" rows="3" placeholder="Caracter√≠sticas especiales, material, garant√≠a, etc."></textarea>
            </div>
            
            <button type="button" onclick="guardarProducto()" class="btn btn-primary">
                üíæ Guardar Producto
            </button>
            <button type="button" onclick="limpiarFormulario()" class="btn btn-secondary">
                üóëÔ∏è Limpiar Formulario
            </button>
        </div>

        <div id="listaProductos" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 25px; padding: 30px; margin-bottom: 30px;">
            <h2 class="section-title">üì¶ Productos Registrados</h2>
            <div style="text-align: center; padding: 40px; opacity: 0.7;">
                <div style="font-size: 48px; margin-bottom: 15px;">üì¶</div>
                <div>No hay productos registrados</div>
            </div>
        </div>
    </div>

    <div class="footer-credits">
        by fbrugal jrubinstein consultores
    </div>
<!-- SCRIPT COMPLETO PARA ADMIN -->
<script>
    // Configuraci√≥n global
    var CONFIG = {
        whatsapp: '18097135307',
        empresa: '√ìptica nVision',
        baseUrl: window.location.origin + window.location.pathname.replace(/[^/]*$/, '')
    };

    // Variables globales
    var imagenCapturada = null;
    var productos = {};

    // Inicializaci√≥n
    window.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Iniciando Admin Panel...');
        cargarProductos();
        configurarEventos();
        console.log('‚úÖ Admin Panel listo');
    });

    function configurarEventos() {
        document.getElementById('inputFoto').addEventListener('change', manejarArchivoSeleccionado);
    }

    // Funciones de navegaci√≥n
    function irASitio() {
        mostrarAlerta('üè† Redirigiendo al sitio principal...', 'success');
        setTimeout(function() {
            window.location.href = 'index.html';
        }, 1000);
    }

    function irAPOS() {
        mostrarAlerta('üíº Abriendo sistema POS...', 'success');
        setTimeout(function() {
            window.location.href = 'pos-parte1.html';
        }, 1000);
    }

    // Funciones de c√°mara
    function abrirCamara() {
        console.log('üì∑ Abriendo c√°mara...');
        
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment' } 
            })
            .then(function(stream) {
                mostrarAlerta('üì∑ C√°mara activada - Use bot√≥n de archivo por ahora', 'success');
                document.getElementById('inputFoto').click();
            })
            .catch(function(error) {
                console.log('Error de c√°mara:', error);
                document.getElementById('inputFoto').click();
            });
        } else {
            document.getElementById('inputFoto').click();
        }
    }

    function manejarArchivoSeleccionado(event) {
        var archivo = event.target.files[0];
        if (archivo) {
            var reader = new FileReader();
            reader.onload = function(e) {
                imagenCapturada = e.target.result;
                var preview = document.getElementById('vistaPrevia');
                preview.src = imagenCapturada;
                preview.style.display = 'block';
                document.getElementById('botonesCompartir').style.display = 'grid';
                mostrarAlerta('‚úÖ Imagen cargada correctamente', 'success');
            };
            reader.readAsDataURL(archivo);
        }
    }

    // Funciones de productos
    function guardarProducto() {
        console.log('üíæ Guardando producto...');
        
        var codigo = document.getElementById('codigoProducto').value.trim().toUpperCase();
        var nombre = document.getElementById('nombreProducto').value.trim();
        var precio = document.getElementById('precioProducto').value.trim();
        var categoria = document.getElementById('categoriaProducto').value;
        var comentarios = document.getElementById('comentariosProducto').value.trim();
        
        if (!codigo || !nombre || !precio) {
            mostrarAlerta('‚ùå C√≥digo, nombre y precio son obligatorios', 'error');
            return;
        }
        
        if (!imagenCapturada) {
            mostrarAlerta('‚ùå Debe agregar una foto del producto', 'error');
            return;
        }

        var producto = {
            codigo: codigo,
            nombre: nombre,
            precio: 'RD$' + parseFloat(precio).toFixed(2),
            categoria: categoria,
            imagen: imagenCapturada,
            comentarios: comentarios,
            enlace: CONFIG.baseUrl + 'index.html?codigo=' + codigo,
            fechaCreacion: new Date().toISOString()
        };

        productos[codigo] = producto;
        localStorage.setItem('nvision_productos', JSON.stringify(productos));

        mostrarAlerta('‚úÖ Producto guardado correctamente', 'success');
        limpiarFormulario();
        cargarProductos();
    }

    function limpiarFormulario() {
        document.getElementById('codigoProducto').value = '';
        document.getElementById('nombreProducto').value = '';
        document.getElementById('precioProducto').value = '';
        document.getElementById('categoriaProducto').value = 'hombre';
        document.getElementById('comentariosProducto').value = '';
        document.getElementById('vistaPrevia').style.display = 'none';
        document.getElementById('botonesCompartir').style.display = 'none';
        imagenCapturada = null;
    }

    function cargarProductos() {
        productos = JSON.parse(localStorage.getItem('nvision_productos') || '{}');
        var container = document.getElementById('listaProductos');
        
        if (Object.keys(productos).length === 0) {
            container.innerHTML = '<h2 class="section-title">üì¶ Productos Registrados</h2><div style="text-align: center; padding: 40px; opacity: 0.7;"><div style="font-size: 48px; margin-bottom: 15px;">üì¶</div><div>No hay productos registrados</div></div>';
            return;
        }

        var html = '<h2 class="section-title">üì¶ Productos Registrados</h2>';
        Object.values(productos).forEach(function(producto) {
            html += '<div style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px;">';
            html += '<img src="' + producto.imagen + '" alt="' + producto.nombre + '" style="width: 60px; height: 60px; border-radius: 10px; object-fit: cover; border: 2px solid rgba(255, 255, 255, 0.2);">';
            html += '<div style="flex: 1;">';
            html += '<div style="font-weight: 700; color: #60a5fa; margin-bottom: 5px;">' + producto.codigo + '</div>';
            html += '<div style="margin-bottom: 5px;">' + producto.nombre + '</div>';
            html += '<div style="color: #22d3ee; font-weight: 600;">' + producto.precio + '</div>';
            html += '</div>';
            html += '<div style="display: flex; flex-direction: column; gap: 5px;">';
            html += '<button onclick="compartirProducto(\'' + producto.codigo + '\')" style="background: #25d366; color: white; border: none; padding: 6px 10px; border-radius: 8px; cursor: pointer; font-size: 11px; touch-action: manipulation;">üì± Compartir</button>';
            html += '<button onclick="eliminarProducto(\'' + producto.codigo + '\')" style="background: #ef4444; color: white; border: none; padding: 6px 10px; border-radius: 8px; cursor: pointer; font-size: 11px; touch-action: manipulation;">üóëÔ∏è Eliminar</button>';
            html += '</div>';
            html += '</div>';
        });
        
        container.innerHTML = html;
    }

    function eliminarProducto(codigo) {
        if (confirm('¬øEst√° seguro de eliminar el producto ' + codigo + '?')) {
            delete productos[codigo];
            localStorage.setItem('nvision_productos', JSON.stringify(productos));
            cargarProductos();
            mostrarAlerta('üóëÔ∏è Producto eliminado', 'success');
        }
    }

    function compartirProducto(codigo) {
        var producto = productos[codigo];
        if (producto) {
            var mensaje = 'üè• *√ìPTICA NVISION* üè•\n\nüì∏ Te comparto esta montura:\nüî¢ C√≥digo: ' + producto.codigo + '\nüí∞ Precio: ' + producto.precio + '\nüìù Descripci√≥n: ' + producto.nombre + '\n\nüîó Ver m√°s detalles: ' + producto.enlace + '\n\nüëÅÔ∏è ¬°Tu visi√≥n n√≠tida, nuestra misi√≥n! ‚ú®';
            
            var url = 'https://wa.me/?text=' + encodeURIComponent(mensaje);
            window.open(url, '_blank');
            mostrarAlerta('‚úÖ Compartiendo por WhatsApp', 'success');
        }
    }

    function copiarEnlace() {
        var codigo = document.getElementById('codigoProducto').value.trim().toUpperCase();
        if (!codigo) {
            mostrarAlerta('‚ùå Primero ingrese el c√≥digo del producto', 'error');
            return;
        }
        
        var enlace = CONFIG.baseUrl + 'index.html?codigo=' + codigo;
        
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(enlace)
                .then(function() {
                    mostrarAlerta('‚úÖ Enlace copiado al portapapeles', 'success');
                })
                .catch(function() {
                    copiarTextoFallback(enlace);
                });
        } else {
            copiarTextoFallback(enlace);
        }
    }

    function copiarTextoFallback(texto) {
        var textArea = document.createElement("textarea");
        textArea.value = texto;
        textArea.style.position = "fixed";
        textArea.style.left = "-999999px";
        document.body.appendChild(textArea);
        textArea.select();
        
        try {
            document.execCommand('copy');
            mostrarAlerta('‚úÖ Enlace copiado', 'success');
        } catch (err) {
            mostrarAlerta('‚ùå No se pudo copiar', 'error');
        }
        
        document.body.removeChild(textArea);
    }

    function compartirWhatsApp() {
        var codigo = document.getElementById('codigoProducto').value.trim().toUpperCase();
        var nombre = document.getElementById('nombreProducto').value.trim();
        var precio = document.getElementById('precioProducto').value.trim();
        
        if (!codigo || !nombre || !precio) {
            mostrarAlerta('‚ùå Complete los datos del producto primero', 'error');
            return;
        }
        
        var enlace = CONFIG.baseUrl + 'index.html?codigo=' + codigo;
        var mensaje = 'üè• *√ìPTICA NVISION* üè•\n\nüì∏ Te comparto esta montura:\nüî¢ C√≥digo: ' + codigo + '\nüí∞ Precio: RD$' + parseFloat(precio).toFixed(2) + '\nüìù Descripci√≥n: ' + nombre + '\n\nüîó Ver m√°s detalles: ' + enlace + '\n\nüëÅÔ∏è ¬°Tu visi√≥n n√≠tida, nuestra misi√≥n! ‚ú®';
        
        var url = 'https://wa.me/?text=' + encodeURIComponent(mensaje);
        window.open(url, '_blank');
        mostrarAlerta('‚úÖ Compartiendo por WhatsApp', 'success');
    }

    function mostrarAlerta(mensaje, tipo) {
        if (!tipo) tipo = 'success';
        var alertHtml = '<div class="alert alert-' + tipo + '">' + mensaje + '</div>';
        document.getElementById('alertContainer').innerHTML = alertHtml;
        
        setTimeout(function() {
            document.getElementById('alertContainer').innerHTML = '';
        }, 4000);
    }

    // Validaci√≥n del sistema
    function validarSistema() {
        console.log('üîç Validando Admin...');
        
        var errores = [];
        
        if (typeof(Storage) === "undefined") {
            errores.push('LocalStorage no disponible');
        }
        
        var elementosRequeridos = ['codigoProducto', 'nombreProducto', 'precioProducto'];
        elementosRequeridos.forEach(function(id) {
            if (!document.getElementById(id)) {
                errores.push('Elemento ' + id + ' no encontrado');
            }
        });
        
        if (errores.length > 0) {
            console.error('Errores del sistema:', errores);
            mostrarAlerta('‚ö†Ô∏è Sistema con errores: ' + errores.join(', '), 'error');
            return false;
        }
        
        return true;
    }

    // Auto-validaci√≥n
    window.addEventListener('load', function() {
        setTimeout(function() {
            if (validarSistema()) {
                console.log('‚úÖ Admin Panel validado correctamente');
                mostrarAlerta('‚úÖ Panel Admin cargado correctamente', 'success');
            }
        }, 1000);
    });

    // Manejo de errores
    window.addEventListener('error', function(event) {
        console.error('Error capturado:', event.error);
        mostrarAlerta('‚ùå Error del sistema: ' + event.error.message, 'error');
    });
</script>
</body>
</html>
