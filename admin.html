<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Urbana Visi√≥n</title>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            color: white; 
            padding: 20px;
        }
        .container { max-width: 500px; margin: 0 auto; }
        
        .header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .by-line {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 10px;
            color: #e2e8f0;
        }
        
        .header-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .header-btn {
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 12px;
            cursor: pointer;
            border: 1px solid;
            font-weight: 600;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }
        
        .btn-home {
            background: rgba(34, 211, 238, 0.2);
            color: #22d3ee;
            border-color: rgba(34, 211, 238, 0.3);
        }
        
        .btn-pos {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.3);
        }

        .btn-central {
            background: rgba(99, 102, 241, 0.2);
            color: #6366f1;
            border-color: rgba(99, 102, 241, 0.3);
        }

        .btn-backup {
            background: rgba(99, 102, 241, 0.2);
            color: #6366f1;
            border-color: rgba(99, 102, 241, 0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 900;
            color: #22d3ee;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(34, 211, 238, 0.3);
        }
        
        .stat-label {
            font-size: 14px;
            font-weight: 600;
            opacity: 0.9;
        }
        
        .form-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            color: #fbbf24;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e2e8f0;
            font-size: 14px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 15px;
            font-size: 16px;
            font-family: inherit;
        }
        
        .form-input::placeholder, .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #22d3ee;
            box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.1);
        }
        
        .camera-upload {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 50px 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
            touch-action: manipulation;
        }
        
        .camera-upload:hover, .camera-upload:active {
            background: rgba(255, 255, 255, 0.15);
            border-color: #22d3ee;
        }
        
        .camera-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }
        
        .preview-image {
            max-width: 100%;
            width: 100%;
            height: auto;
            max-height: 400px;
            border-radius: 15px;
            margin-top: 20px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            object-fit: cover;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 18px 20px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            touch-action: manipulation;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #22d3ee, #0891b2);
            color: white;
            box-shadow: 0 4px 15px rgba(34, 211, 238, 0.3);
        }
        
        .btn-primary:hover, .btn-primary:active {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 211, 238, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover, .btn-secondary:active {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f59e0b, #d97706);
            color: white;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }
        
        .btn-small {
            padding: 12px;
            font-size: 14px;
            border-radius: 12px;
        }
        
        .products-list {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .product-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .product-thumb {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .product-info {
            flex: 1;
        }
        
        .product-code {
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 5px;
        }
        
        .product-price {
            color: #22d3ee;
            font-weight: 600;
        }
        
        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            touch-action: manipulation;
        }
        
        .alert {
            background: rgba(34, 211, 238, 0.2);
            border: 1px solid rgba(34, 211, 238, 0.3);
            color: #22d3ee;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }
        
        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.2);
            border-color: rgba(245, 158, 11, 0.3);
            color: #f59e0b;
        }

        .share-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-share {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .btn-whatsapp {
            background: #25d366;
            color: white;
        }

        .btn-copy {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Espec√≠fico para m√≥viles */
        @media (max-width: 480px) {
            .container { padding: 10px; }
            .header { padding: 20px; }
            .header h1 { font-size: 24px; }
            .btn { padding: 15px; font-size: 14px; }
            .stats-grid { grid-template-columns: 1fr; }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Panel de Administraci√≥n</h1>
            <p>Gesti√≥n completa de Urbana Visi√≥n</p>
            <div class="by-line">by fbrugaljrubinstein consultores</div>
            <div class="header-buttons">
                <button onclick="goToMainSite()" class="header-btn btn-home">
                    üè† Sitio Principal
                </button>
                <button onclick="abrirPOS()" class="header-btn btn-pos">
                    üíº Sistema POS
                </button>
                <button onclick="goToCentral()" class="header-btn btn-central">
                    üéØ Central
                </button>
                <button onclick="crearBackup()" class="header-btn btn-backup">
                    üíæ Backup
                </button>
            </div>
        </div>

        <div id="alertContainer"></div>

        <!-- ESTAD√çSTICAS -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalProductos">0</div>
                <div class="stat-label">Productos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalClientes">0</div>
                <div class="stat-label">Clientes</div>
            </div>
        </div>

        <!-- ACCIONES R√ÅPIDAS -->
        <div class="action-buttons">
            <button onclick="verProductos()" class="btn btn-primary btn-small">
                üì¶ Ver Productos
            </button>
            <button onclick="verClientes()" class="btn btn-success btn-small">
                üë• Ver Clientes
            </button>
            <button onclick="configurarSistema()" class="btn btn-warning btn-small">
                ‚öôÔ∏è Configurar
            </button>
        </div>

        <!-- NUEVO PRODUCTO -->
        <div class="form-section">
            <h2 class="section-title">üì∏ Nuevo Producto</h2>
            
            <div class="form-group">
                <label class="form-label">üì∑ Foto del Producto</label>
                <div class="camera-upload" onclick="tomarFoto()">
                    <span class="camera-icon">üì∏</span>
                    <div>Tomar foto con c√°mara</div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">
                        Para mostrar en WhatsApp
                    </div>
                    <img id="previewImage" class="preview-image" style="display: none;">
                </div>
                <input type="file" id="inputFoto" accept="image/*" capture="environment" style="display: none;">
            </div>
            
            <div class="form-group">
                <label class="form-label">üî§ C√≥digo del Producto</label>
                <input type="text" id="productCode" class="form-input" placeholder="UV001, UV002..." style="text-transform: uppercase;">
            </div>
            
            <div class="form-group">
                <label class="form-label">üìù Nombre/Descripci√≥n</label>
                <textarea id="productName" class="form-textarea" rows="3" placeholder="Montura elegante para dama con cristales antirreflejos..."></textarea>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label class="form-label">üí∞ Precio</label>
                    <input type="text" id="productPrice" class="form-input" placeholder="RD$2,500">
                </div>
                <div class="form-group">
                    <label class="form-label">üìÇ Categor√≠a</label>
                    <select id="productCategory" class="form-select">
                        <option value="monturas">üëì Monturas</option>
                        <option value="lentes">üîç Lentes</option>
                        <option value="accesorios">‚ö° Accesorios</option>
                        <option value="graduados">üìè Graduados</option>
                    </select>
                </div>
            </div>
            
            <div class="button-group">
                <button onclick="guardarProducto()" class="btn btn-primary">
                    üíæ Guardar
                </button>
                <button onclick="compartirWhatsApp()" class="btn btn-success">
                    üí¨ Compartir
                </button>
            </div>
        </div>

        <!-- LISTA DE PRODUCTOS -->
        <div class="products-list" id="productsList">
            <h2 class="section-title">üì¶ Productos Registrados</h2>
            <div id="productsContainer">
                <div style="text-align: center; padding: 40px; opacity: 0.7;">
                    üì¶ No hay productos registrados a√∫n
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURACI√ìN FIREBASE - CAMBIAR POR LA REAL
        const firebaseConfig = {
            apiKey: "AIzaSyC8example_key_replace_with_real",
            authDomain: "urbana-vision.firebaseapp.com",
            databaseURL: "https://urbana-vision-default-rtdb.firebaseio.com",
            projectId: "urbana-vision",
            storageBucket: "urbana-vision.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // VARIABLES GLOBALES
        var WHATSAPP_NUMBER = '18097135307';
        var BASE_URL = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
        var currentPhotoBlob = null;

        // FUNCIONES DE UTILIDAD
        function safeGetStorage(key) {
            try {
                if (typeof(Storage) !== "undefined" && localStorage) {
                    var value = localStorage.getItem(key);
                    if (value && value !== 'null' && value !== 'undefined') {
                        return JSON.parse(value);
                    }
                }
            } catch (e) {
                console.log('Storage error:', e);
            }
            return {};
        }

        function safeSetStorage(key, value) {
            try {
                if (typeof(Storage) !== "undefined" && localStorage) {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                }
            } catch (e) {
                console.log('Storage error:', e);
                return false;
            }
        }

        function showAlert(message, type = 'success') {
            var alertClass = type === 'error' ? 'alert-error' : type === 'success' ? 'alert-success' : type === 'warning' ? 'alert-warning' : 'alert';
            var alertHtml = `<div class="alert ${alertClass}">${message}</div>`;
            document.getElementById('alertContainer').innerHTML = alertHtml;
            
            setTimeout(function() {
                document.getElementById('alertContainer').innerHTML = '';
            }, 5000);
        }

        // FUNCIONES DE NAVEGACI√ìN
        function goToMainSite() {
            window.location.href = BASE_URL + 'index.html';
        }

        function abrirPOS() {
            var password = prompt('üîê Contrase√±a del Sistema POS:');
            if (password === 'urbana2030') {
                window.location.href = BASE_URL + 'pos.html';
            } else if (password !== null) {
                showAlert('‚ùå Contrase√±a incorrecta', 'error');
            }
        }

        function goToCentral() {
            window.location.href = BASE_URL + 'central.html';
        }

        // FUNCIONES DE PRODUCTO
        function tomarFoto() {
            document.getElementById('inputFoto').click();
        }

        function guardarProducto() {
            var codigo = document.getElementById('productCode').value.trim().toUpperCase();
            var nombre = document.getElementById('productName').value.trim();
            var precio = document.getElementById('productPrice').value.trim();
            var categoria = document.getElementById('productCategory').value;
            
            if (!codigo || !nombre || !precio) {
                showAlert('‚ö†Ô∏è Complete todos los campos obligatorios', 'error');
                return;
            }
            
            if (!currentPhotoBlob) {
                showAlert('‚ö†Ô∏è Debe agregar una foto del producto', 'error');
                return;
            }
            
            // Convertir foto a base64
            var reader = new FileReader();
            reader.onload = function(e) {
                var monturas = safeGetStorage('urbana_monturas') || {};
                var productos = safeGetStorage('urbana_productos') || {};
                
                var producto = {
                    codigo: codigo,
                    nombre: nombre,
                    descripcion: nombre,
                    precio: precio,
                    precioBase: parseFloat(precio.replace(/[^0-9.-]+/g,"")) || 0,
                    categoria: categoria,
                    foto: e.target.result,
                    fechaCreacion: new Date().toISOString(),
                    enlace: `${BASE_URL}index.html?codigo=${codigo}`,
                    whatsapp: `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent('Hola, me interesa la montura ' + codigo + ' "' + nombre + '" por ' + precio + '. ¬øEst√° disponible?')}`
                };
                
                // Guardar en ambos sistemas para compatibilidad
                monturas[codigo] = producto;
                productos[codigo] = producto;
                
                safeSetStorage('urbana_monturas', monturas);
                safeSetStorage('urbana_productos', productos);
                
                showAlert('‚úÖ Producto guardado exitosamente: ' + codigo, 'success');
                limpiarFormulario();
                cargarProductos();
                actualizarEstadisticas();
            };
            
            reader.readAsDataURL(currentPhotoBlob);
        }

        function limpiarFormulario() {
            document.getElementById('productCode').value = '';
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productCategory').value = 'monturas';
            document.getElementById('previewImage').style.display = 'none';
            document.getElementById('inputFoto').value = '';
            currentPhotoBlob = null;
        }

        function compartirWhatsApp() {
            var codigo = document.getElementById('productCode').value.trim().toUpperCase();
            var nombre = document.getElementById('productName').value.trim();
            var precio = document.getElementById('productPrice').value.trim();
            
            if (!codigo || !nombre || !precio) {
                showAlert('‚ö†Ô∏è Complete los campos antes de compartir', 'error');
                return;
            }
            
            var mensaje = `üëÅÔ∏è *NUEVA MONTURA DISPONIBLE - URBANA VISI√ìN* üëÅÔ∏è

üì∏ Nueva montura en cat√°logo:
üî¢ C√≥digo: ${codigo}
üí∞ Precio: ${precio}
üìù Descripci√≥n: ${nombre}

üîó Ver detalles completos:
${BASE_URL}index.html?codigo=${codigo}

‚ú® Caracter√≠sticas:
‚Ä¢ Garant√≠a de calidad premium
‚Ä¢ Ajustes gratuitos incluidos
‚Ä¢ Entrega sin costo adicional

üëÅÔ∏è ¬°Vea mejor, viva mejor! ‚ú®
by fbrugaljrubinstein consultores`;
            
            var whatsappUrl = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
            window.open(whatsappUrl, '_blank');
            
            showAlert('üí¨ Producto compartido por WhatsApp', 'success');
        }

        function cargarProductos() {
            var monturas = safeGetStorage('urbana_monturas') || {};
            var container = document.getElementById('productsContainer');
            
            if (Object.keys(monturas).length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;">üì¶ No hay productos registrados a√∫n</div>';
                return;
            }
            
            var html = '';
            Object.keys(monturas).forEach(function(codigo) {
                var producto = monturas[codigo];
                html += `
                    <div class="product-item">
                        <img src="${producto.foto}" alt="${producto.codigo}" class="product-thumb">
                        <div class="product-info">
                            <div class="product-code">${producto.codigo}</div>
                            <div style="font-size: 14px; margin-bottom: 5px;">${producto.nombre.substring(0, 40)}...</div>
                            <div class="product-price">${producto.precio}</div>
                        </div>
                        <div class="share-buttons">
                            <button onclick="compartirProducto('${codigo}')" class="btn-share btn-whatsapp">üí¨</button>
                            <button onclick="eliminarProducto('${codigo}')" class="btn-share delete-btn">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function compartirProducto(codigo) {
            var monturas = safeGetStorage('urbana_monturas') || {};
            var producto = monturas[codigo];
            
            if (producto) {
                var mensaje = `üëÅÔ∏è *URBANA VISI√ìN* üëÅÔ∏è

üì∏ Te comparto esta montura:
üî¢ C√≥digo: ${producto.codigo}
üí∞ Precio: ${producto.precio}
üìù Descripci√≥n: ${producto.nombre}

üîó Ver m√°s detalles: ${producto.enlace}

üëÅÔ∏è ¬°Vea mejor, viva mejor! ‚ú®
by fbrugaljrubinstein consultores`;
                
                var whatsappUrl = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
                window.open(whatsappUrl, '_blank');
                showAlert('‚úÖ Producto compartido', 'success');
            }
        }

        function eliminarProducto(codigo) {
            if (confirm('¬øEst√° seguro de eliminar el producto ' + codigo + '?')) {
                var monturas = safeGetStorage('urbana_monturas') || {};
                var productos = safeGetStorage('urbana_productos') || {};
                
                delete monturas[codigo];
                delete productos[codigo];
                
                safeSetStorage('urbana_monturas', monturas);
                safeSetStorage('urbana_productos', productos);
                
                showAlert('üóëÔ∏è Producto eliminado: ' + codigo, 'success');
                cargarProductos();
                actualizarEstadisticas();
            }
        }

        function actualizarEstadisticas() {
            var monturas = safeGetStorage('urbana_monturas') || {};
            var clientes = safeGetStorage('urbana_clientes') || {};
            
            document.getElementById('totalProductos').textContent = Object.keys(monturas).length;
            document.getElementById('totalClientes').textContent = Object.keys(clientes).length;
        }

        function verProductos() {
            var monturas = safeGetStorage('urbana_monturas') || {};
            var total = Object.keys(monturas).length;
            
            showAlert(`üì¶ Total de productos: ${total}`, 'success');
            
            if (total > 0) {
                var lista = Object.keys(monturas).map(codigo => {
                    var producto = monturas[codigo];
                    return `${codigo}: ${producto.precio}`;
                }).join('\n');
                
                alert('üì¶ PRODUCTOS REGISTRADOS:\n\n' + lista);
            }
        }

        function verClientes() {
            var clientes = safeGetStorage('urbana_clientes') || {};
            var total = Object.keys(clientes).length;
            
            showAlert(`üë• Total de clientes: ${total}`, 'success');
            
            if (total > 0) {
                var lista = Object.keys(clientes).map(telefono => {
                    var cliente = clientes[telefono];
                    return `${cliente.nombre}: ${telefono}`;
                }).join('\n');
                
                alert('üë• CLIENTES REGISTRADOS:\n\n' + lista);
            }
        }

        function configurarSistema() {
            var config = prompt(`‚öôÔ∏è CONFIGURACI√ìN DEL SISTEMA

Opciones disponibles:
1. Cambiar n√∫mero WhatsApp
2. Configurar Firebase
3. Limpiar datos
4. Exportar todo

Escriba el n√∫mero de opci√≥n:`);
            
            switch(config) {
                case '1':
                    var nuevoNumero = prompt('üì± Nuevo n√∫mero WhatsApp (formato: 18097135307):');
                    if (nuevoNumero) {
                        WHATSAPP_NUMBER = nuevoNumero;
                        showAlert('‚úÖ N√∫mero actualizado', 'success');
                    }
                    break;
                case '2':
                    showAlert('üîß Configure Firebase en el c√≥digo fuente', 'warning');
                    break;
                case '3':
                    if (confirm('‚ö†Ô∏è ¬øEliminar TODOS los datos? Esta acci√≥n no se puede deshacer.')) {
                        localStorage.clear();
                        showAlert('üóëÔ∏è Datos eliminados', 'success');
                        setTimeout(() => window.location.reload(), 2000);
                    }
                    break;
                case '4':
                    crearBackup();
                    break;
                default:
                    showAlert('‚ùå Opci√≥n no v√°lida', 'error');
            }
        }

        function crearBackup() {
            try {
                var allData = {
                    monturas: safeGetStorage('urbana_monturas'),
                    clientes: safeGetStorage('urbana_clientes'),
                    productos: safeGetStorage('urbana_productos'),
                    facturas: safeGetStorage('urbana_facturas'),
                    estadisticas: {
                        views: localStorage.getItem('urbana_views') || '0',
                        clicks: localStorage.getItem('urbana_whatsapp_clicks') || '0'
                    },
                    export_info: {
                        timestamp: new Date().toISOString(),
                        version: '3.0',
                        sistema: 'Urbana_Vision_Admin',
                        by: 'fbrugaljrubinstein consultores'
                    }
                };

                var blob = new Blob([JSON.stringify(allData, null, 2)], {type: 'application/json'});
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'urbana_vision_backup_' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showAlert('‚úÖ Backup creado exitosamente', 'success');
            } catch (error) {
                console.error('Error creando backup:', error);
                showAlert('‚ùå Error al crear backup', 'error');
            }
        }

        // Event listener para la c√°mara
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('inputFoto').addEventListener('change', function(e) {
                var file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        showAlert('‚ö†Ô∏è La imagen es muy grande. Use una imagen menor a 5MB.', 'error');
                        return;
                    }
                    
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var preview = document.getElementById('previewImage');
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                        currentPhotoBlob = file;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Cargar datos iniciales
            cargarProductos();
            actualizarEstadisticas();
        });

        // Evitar zoom en m√≥viles
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });

        var lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            var now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
